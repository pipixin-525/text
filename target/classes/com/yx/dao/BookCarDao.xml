<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yx.dao.BookCarDao">
    <!--将图书加入购物车
    public int insertBookCar(@Param("userId") Integer userId, @Param("bookId")Integer bookId);-->
    <insert id="insertBookCar">
        insert into db2.book_car(book_id, book_name, book_price, book_amount, total_price, user_id)
        select book_id, book_name, book_price, 1, book_price, ${userId}
        from db2.book_info
        where book_id = #{bookId}
    </insert>


    <!--根据用户Id查询购物车数据
    public List<BookCar> selectBookCarByUserId(@Param("userId")Integer userId);-->
    <select id="selectBookCarByUserId" resultType="com.yx.entities.BookCar">
        select car_id, book_id, book_name, book_price, book_amount, total_price, user_id
        from db2.book_car
        where user_id = #{userId}
    </select>


    <!--查询当前用户购物车中是否有对应编号的图书
    public int selectCountByUserIdAndBookId(@Param("userId")Integer userId, @Param("bookId")Integer bookId);-->
    <select id="selectCountByUserIdAndBookId" resultType="int">
        select count(*)
        from db2.book_car
        where user_id = #{userId}
          and book_id = #{bookId}
    </select>


    <!--同一图书多次加入到购物车时修改图书的总价和数量
    public int updateBookCarByUserIdAndBookId(@Param("userId")Integer userId, @Param("boookId")Integer boookId);-->
    <update id="updateBookCarByUserIdAndBookId">
        update db2.book_car
        set book_amount = book_amount + 1,
            total_price = total_price + book_price
        where user_id = #{userId}
          and book_id = #{boookId}
    </update>

    <!--修改购物车中图书数量
    public int updateBookCarBookAmountAndTotalPrice(@Param("carId")Integer carId, @Param("bookAmount")Integer bookAmount);-->
    <update id="updateBookCarBookAmountAndTotalPrice">
        update db2.book_car
        set book_amount = #{bookAmount},
            total_price = #{bookAmount} * book_price
        where car_id = #{carId}
    </update>


    <!--删除购物车中的图书
    public int deleteBookCar(Integer carId);-->
    <delete id="deleteBookCar">
        delete
        from db2.book_car
        where car_id = #{carId}
    </delete>
</mapper>